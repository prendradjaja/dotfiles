#!/usr/bin/env python3

import subprocess
import re


def main():
    pattern = r'https://github\.com/prendradjaja/([-a-z0-9]+)(\.git)?'
    output = subprocess.run(['git', 'remote', 'get-url', 'origin'], capture_output=True, text=True).stdout.strip('\n')
    match = re.fullmatch(pattern, output)
    if not match:
        print('Output of `git remote get-url origin` did not match pattern.')
        print('Output:', repr(output))
        print('Pattern:', repr(pattern))
        exit(1)

    repo_name = match.group(1)
    new_url = f'git@github.com:prendradjaja/{repo_name}.git'

    subprocess.run(['git', 'remote', 'set-url', 'origin', new_url])

    print(f'''
Successfully migrated to SSH.
Old origin:
  {match.group(0)}

New origin:
$ git remote -v
'''.strip('\n'))

    subprocess.run(['git', 'remote', '-v'])


if __name__ == '__main__':
    main()
